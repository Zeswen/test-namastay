function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _define_property(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_define_property(target,key,source[key])})}return target}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _object_spread_props(target,source){source=source!=null?source:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}const parseURI=uri=>decodeURIComponent(uri).replace("/&amp;/g","&");const objectFromEntries=pairs=>Array.from(pairs).reduce((object,[key,value])=>_object_spread_props(_object_spread({},object),{[key]:value}),{});const searchFromLink=linkElement=>{try{const href=linkElement.getAttribute("href");if(!href)return undefined;const parsedURI=parseURI(href);const queryParameters=new URL(parsedURI).searchParams;if(!queryParameters)return undefined;return{startDate:queryParameters.get("arrive"),endDate:queryParameters.get("depart"),ratePlanCode:queryParameters.get("rate"),adult:queryParameters.get("adult"),child:queryParameters.get("child"),rooms:queryParameters.get("rooms")}}catch(error){console.error(error);return undefined}};const loadScript=src=>{const promise=new Promise((resolve,reject)=>{const script=document.createElement("script");script.src=src;script.async=true;const onScriptLoad=()=>{resolve()};const onScriptError=()=>{script.remove();reject(new Error(`Unable to load script ${src}`))};script.addEventListener("load",onScriptLoad);script.addEventListener("error",onScriptError);document.body.append(script)});return promise};const canMakePayments=()=>{const{ApplePaySession:ApplePaySession1}=window;if(!ApplePaySession1){return false}try{return ApplePaySession1.canMakePayments()}catch(e){console.error(e);return false}};const createNamastayURL=(apiKey,spreedlyApiKey)=>{if(!"https://dev.namastay.io"||!apiKey||!spreedlyApiKey){const missingFrameUrl=!"https://dev.namastay.io"?"Frame URL":"";const missingApiKey=!apiKey?"API Key":"";const missingSpreedlyApiKey=!spreedlyApiKey?"Spreedly API Key":"";const missingProperties=[missingFrameUrl,missingApiKey,missingSpreedlyApiKey].filter(Boolean).join(" & ");throw new Error(`[Namastay SDK] ${missingProperties} not defined.`)}const urlSearchParams=new URLSearchParams(window.location.search);const queryParametersPayload=_object_spread({spreedlyApiKey},objectFromEntries(urlSearchParams.entries()));const namastayLanguage=document.documentElement.lang;const queryParameters=Object.keys(queryParametersPayload).map(key=>`${key}=${queryParametersPayload[key]}`).join("&");const path=`/${queryParametersPayload.apiKey||apiKey}`;const url=`${"https://dev.namastay.io"}/${namastayLanguage}/${path}?${queryParameters}`;return url};const createNamastayFrame=url=>{const namastayFrame=document.createElement("iframe");namastayFrame.setAttribute("allow","payment");namastayFrame.setAttribute("name","Namastay App");namastayFrame.setAttribute("title","Namastay App");namastayFrame.setAttribute("src",url);document.body.appendChild(namastayFrame);namastayFrame.style.display="none";namastayFrame.style.position="fixed";namastayFrame.style.top="0";namastayFrame.style.left="0";namastayFrame.style.width="100%";namastayFrame.style.height="100%";namastayFrame.style.border="none";namastayFrame.style.zIndex="2147483647";namastayFrame.style.visibility="hidden";namastayFrame.style.opacity="0";namastayFrame.style.transition="visibility 150ms linear, opacity 150ms linear";return namastayFrame};const initNamastay=({apiKey,specialOfferButtonsClass,spreedlyApiKey,useWixIconSelector,widgetButtonsClass})=>{try{const url=createNamastayURL(apiKey,spreedlyApiKey);const namastayFrame=createNamastayFrame(url);let isFrameReadyForMessages=false;let initialOverflow;const messageQueue=[];const sendMessageToApp=({type,payload})=>{if(isFrameReadyForMessages){var _namastayFrame_contentWindow;(_namastayFrame_contentWindow=namastayFrame.contentWindow)===null||_namastayFrame_contentWindow===void 0?void 0:_namastayFrame_contentWindow.postMessage({type,payload},"*")}else{messageQueue.push({type,payload})}};const sendQueuedMessagesToApp=()=>{messageQueue.forEach(message=>{sendMessageToApp(message)})};const listenToAppMessages=messages=>{const handleMessage=messageEvent=>{var _messageEvent_data;const{type,payload}=(_messageEvent_data=messageEvent===null||messageEvent===void 0?void 0:messageEvent.data)!==null&&_messageEvent_data!==void 0?_messageEvent_data:{};const messageCallback=messages[type];if(messageCallback){messageCallback(payload)}};window.addEventListener("message",handleMessage)};const openNamastayFrame=()=>{namastayFrame.style.display="block";setTimeout(()=>{namastayFrame.style.visibility="visible";namastayFrame.style.opacity="1";initialOverflow=document.body.style.overflow;document.body.style.overflow="hidden"},1)};const closeNamastayFrame=()=>{namastayFrame.style.visibility="hidden";namastayFrame.style.opacity="0";document.body.style.overflow=initialOverflow;setTimeout(()=>{namastayFrame.style.display="none"},151)};const openNamastaySearch=event=>{var _button_dataset;event.preventDefault();const button=event===null||event===void 0?void 0:event.target;const linkElement=(button===null||button===void 0?void 0:button.tagName)==="A"?searchFromLink(button):undefined;const{startDate:searchStartDate,endDate:searchEndDate,ratePlanCode:searchRatePlanCode,adult:searchAdult,child:searchChild,rooms:searchRooms,ratePlanCodeFilter:searchRatePlanCodeFilter}=linkElement!==null&&linkElement!==void 0?linkElement:(button===null||button===void 0?void 0:(_button_dataset=button.dataset)===null||_button_dataset===void 0?void 0:_button_dataset.offer)?JSON.parse(button.dataset.offer):{};if(searchStartDate&&searchEndDate&&searchAdult){const currentUrl=new URL(window.location.href);const areDatesExpired=new Date>new Date(searchStartDate);if(!areDatesExpired){currentUrl.searchParams.set("namastay",true.toString());currentUrl.searchParams.set("startDate",searchStartDate);currentUrl.searchParams.set("endDate",searchEndDate);currentUrl.searchParams.set("adult",searchAdult);if(searchChild){currentUrl.searchParams.set("child",searchChild)}if(searchRooms){currentUrl.searchParams.set("rooms",searchRooms)}if(searchRatePlanCodeFilter){currentUrl.searchParams.set("filter",searchRatePlanCodeFilter)}if(searchRatePlanCode){currentUrl.searchParams.set("ratePlanCode",searchRatePlanCode)}window.history.pushState("","",currentUrl)}setTimeout(()=>{sendMessageToApp({type:"namastayInfo",payload:{searchStartDate,searchEndDate,searchRatePlanCode,searchRatePlanCodeFilter,searchAdult,searchChild}})},100);openNamastayFrame()}};const setupEventListeners=()=>{const messages={namastayListenersSetUp:()=>{if(!isFrameReadyForMessages){isFrameReadyForMessages=true;sendQueuedMessagesToApp()}},namastayCloseSDK:closeNamastayFrame,namastayAnalyticsEvent:({event})=>{var _window_dataLayer,_window_dataLayer1;if(!window.dataLayer){console.error("[Namastay SDK] No GTM implementation found on application.");return}(_window_dataLayer=window.dataLayer)===null||_window_dataLayer===void 0?void 0:_window_dataLayer.push({ecommerce:null});(_window_dataLayer1=window.dataLayer)===null||_window_dataLayer1===void 0?void 0:_window_dataLayer1.push(event)},namastayApplePayComplete:({status})=>{var _window_namastayApplePaySession;(_window_namastayApplePaySession=window.namastayApplePaySession)===null||_window_namastayApplePaySession===void 0?void 0:_window_namastayApplePaySession.completePayment(status)},namastayApplePayMerchantValidated:({paymentSession})=>{var _window_namastayApplePaySession;(_window_namastayApplePaySession=window.namastayApplePaySession)===null||_window_namastayApplePaySession===void 0?void 0:_window_namastayApplePaySession.completeMerchantValidation(paymentSession)},namastayApplePaySession:({applePayVersion,applePayConfig,paymentRequest})=>{window.namastayApplePaySession=new ApplePaySession(applePayVersion,paymentRequest);const domainName=window.location.hostname;console.log("[Namastay SDK: Apple Pay] Initialized payment session.");console.log("[Namastay SDK: Apple Pay] Starting payment session...");window.namastayApplePaySession.onvalidatemerchant=function(){var _ref=_async_to_generator(function*(event){console.log("[Namastay SDK: Apple Pay] Validating merchant...");sendMessageToApp({type:"namastayApplePayValidateMerchant",payload:{validationUrl:event.validationURL,domainName}})});return function(event){return _ref.apply(this,arguments)}}();window.namastayApplePaySession.onshippingcontactselected=()=>{var _window_namastayApplePaySession;(_window_namastayApplePaySession=window.namastayApplePaySession)===null||_window_namastayApplePaySession===void 0?void 0:_window_namastayApplePaySession.completeShippingContactSelection(ApplePaySession.STATUS_SUCCESS,[],applePayConfig.total,applePayConfig.lineItems)};window.namastayApplePaySession.onshippingmethodselected=()=>{var _window_namastayApplePaySession;(_window_namastayApplePaySession=window.namastayApplePaySession)===null||_window_namastayApplePaySession===void 0?void 0:_window_namastayApplePaySession.completeShippingMethodSelection(ApplePaySession.STATUS_SUCCESS,applePayConfig.total,applePayConfig.lineItems)};window.namastayApplePaySession.onpaymentmethodselected=()=>{var _window_namastayApplePaySession;(_window_namastayApplePaySession=window.namastayApplePaySession)===null||_window_namastayApplePaySession===void 0?void 0:_window_namastayApplePaySession.completePaymentMethodSelection(applePayConfig.total,applePayConfig.lineItems)};window.namastayApplePaySession.onpaymentauthorized=event=>{console.log("[Namastay SDK: Apple Pay] Authorizing payment...");const{shippingContact,token:paymentToken}=event.payment;sendMessageToApp({type:"namastayApplePayAuthorized",payload:{shippingContact,paymentToken}})};window.namastayApplePaySession.oncancel=event=>{console.error(event)};window.namastayApplePaySession.begin();console.log("[Namastay SDK: Apple Pay] Started payment session.")}};listenToAppMessages(messages)};const setupButtons=()=>{let widgetButtonElements=[];widgetButtonElements=[...document.querySelectorAll(`.${widgetButtonsClass}`)];if(!widgetButtonElements.length&&useWixIconSelector){const wixIconSelector='path[fill="none"][d="M1 0v1H0V0h1z"]';const buttonsWithCustomSvg=document.querySelectorAll(`button span svg > g > ${wixIconSelector} + ${wixIconSelector} + ${wixIconSelector}`);buttonsWithCustomSvg.forEach(svg=>{const closest=svg.closest("button");if(closest){widgetButtonElements.push(closest)}})}if(!widgetButtonElements.length){throw new Error("[Namastay SDK] Widget button elements not found.")}widgetButtonElements.forEach(widgetButton=>{widgetButton.addEventListener("click",openNamastayFrame)});document.querySelectorAll(`.${specialOfferButtonsClass}`).forEach(offerButton=>{offerButton.addEventListener("click",openNamastaySearch)})};const checkIfNamastayShouldOpen=()=>{const namastay=new URL(window.location.href).searchParams.get("namastay");if(namastay==="true"){openNamastayFrame()}};const setupApplePay=function(){var _ref=_async_to_generator(function*(){const APPLE_PAY_SDK_URL="https://applepay.cdn-apple.com/jsapi/v1/apple-pay-sdk.js";try{console.log("[Namastay SDK: Apple Pay] Loading script...");yield loadScript(APPLE_PAY_SDK_URL);console.log("[Namastay SDK: Apple Pay] Loaded script.");sendMessageToApp({type:"namastayApplePayLoad",payload:{isScriptLoaded:canMakePayments()}})}catch(error){console.error(error)}});return function setupApplePay(){return _ref.apply(this,arguments)}}();setupEventListeners();setupButtons();checkIfNamastayShouldOpen();setupApplePay()}catch(error){console.error(error)}};